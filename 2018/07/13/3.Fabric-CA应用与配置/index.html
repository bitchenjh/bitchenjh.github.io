<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Fabric CA 应用与配置</title>
  <meta name="description" content="">
  <meta name="author" content="陈建辉">

  <meta name="keywords" content=""
  />

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Fabric CA 应用与配置">
  <meta name="twitter:description" content="">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Fabric CA 应用与配置">
  <meta property="og:description" content="">
  <meta property="og:site_name" content="e"
  />


  <link rel="icon" type="image/png" href="/images/favicon.png" />
  <link href="/images/favicon.png" rel="shortcut icon" type="image/png">


  <link rel="stylesheet" href=" /css/main.css ">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/2018/07/13/3.Fabric-CA%E5%BA%94%E7%94%A8%E4%B8%8E%E9%85%8D%E7%BD%AE/">
  <link rel="alternate" type="application/rss+xml" title="陈建辉区块链博客" href="http://localhost:4000 /feed.xml
    ">

  <meta name="google-site-verification" content="1-1ZlHoRvM0T2FqPbW2S-qLgYXN6rsn52kErlMPd_gw" />

  <!-- 站点统计 -->
  <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>

<!--注释掉51客服系统，这是个插件-->
  <!--<script>(function() {var _53code = document.createElement("script");_53code.src = "https://tb.53kf.com/code/code/10174862/1";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(_53code, s);})();</script>-->

  <!-- 百度统计 -->
  

  <!-- google 统计 -->
  

  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>

</head>


<body>

  <span class="mobile btn-mobile-menu">        
      <div class="nav_container">
         <nav class="nav-menu-item" style = "float:right">
            <i class="nav-menu-item">
              <a href="/#blog" title="" class="blog-button">  博客主页
              </a>
            </i>
            
                <i class="nav-menu-item">

                  <a href="/archive" title="archive" class="btn-mobile-menu__icon">
                      所有文章
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/tags" title="tags" class="btn-mobile-menu__icon">
                      分类
                  </a>
                </i>
            
                <i class="nav-menu-item">

                  <a href="/about" title="about" class="btn-mobile-menu__icon">
                      关于我
                  </a>
                </i>
            
          </nav>
          
      </div>
    </span> <header class="panel-cover panel-cover--collapsed" style="background-image: url('/images/background-cover.jpg')">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
      <div class="panel-main__content">
        <!-- 头像效果-start -->
        <div class="ih-item circle effect right_to_left">
          <a href="/#blog" title="前往 陈建辉区块链博客 的主页" class="blog-button">
            <div class="img"><img src="/images/avatar.jpg" alt="img"></div>
            <div class="info">
              <div class="info-back">
                <h2 style="font-size: 14px">
                   微信:chenjh07507 
                </h2>´
                <p style="font-size: 6px">
                   区块链从业人员 
                </p>
              </div>
            </div>
          </a>
        </div>
        <!-- 头像效果-end -->
        <h1 class="panel-cover__title panel-title"><a href="/#blog" title="link to homepage for 陈建辉区块链博客" class="blog-button">陈建辉区块链博客</a></h1>
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">陈建辉，项目经理，高级软件工程师，早期区块链从业人员，拥有多年传统金融软件开发经验</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" /> 


        <div class="navigation-wrapper">
          <div>
            <nav class="cover-navigation cover-navigation--primary">
              <ul class="navigation">
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">博客主页</a></li>
                
                <li class="navigation__item"><a href="/archive" title="archive">所有文章</a></li>
                
                <li class="navigation__item"><a href="/tags" title="tags">分类</a></li>
                
                <li class="navigation__item"><a href="/about" title="about">关于我</a></li>
                
              </ul>
            </nav>
          </div>
        </div>

      </div>
    </div>
  </div>

  
  <div class="panel-cover--overlay cover-clear"></div>
  

  </div>
</header>


  <div class="content-wrapper">
    <div class="content-wrapper__inner">
      <article class="post-container post-container--single" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title">Fabric CA 应用与配置</h1>
    <div class="post-meta">
      <img src="/images/calendar.png" width="20px"/>
      <time datetime="2018-07-13 00:00:00 +0800" itemprop="datePublished" class="post-meta__date date">2018-07-13</time>

      <span id="busuanzi_container_page_pv"> | 阅读：<span id="busuanzi_value_page_pv"></span>次</span>
    </p>
    </div>
  </header>

  <section class="post">
    <blockquote>
  <p>作者：陈建辉</p>

  <p>博客：www.chenjianhui.org</p>
</blockquote>

<blockquote>
  <p>备注：如有错误，请指正，不断更新迭代</p>
</blockquote>

<h1 id="fabric-ca-应用与配置">Fabric CA 应用与配置</h1>

<h2 id="简介">简介</h2>

<p>Fabric CA项目是超级账本Fabric内的MemberService组件, 对网络内各个实体的身份证书的管理, 主要实现:</p>

<ul>
  <li>负责Fabric网络内所有实体(Identity)的身份管理, 包括身份的注册、注销等</li>
  <li>负责证书管理, 包括ECerts(身份证书)、TCerts(交易证书)等的发放和注销</li>
  <li>服务端支持基于客户端命令行的RESTful API的交互方式</li>
</ul>

<p>Fabric CA采用Go语言进行编写</p>

<h2 id="基本组件">基本组件</h2>

<p>Fabric CA采用了典型的C/S架构， 目前包含两个基本组件， 分别实现服务端功能和客户端功能</p>

<ul>
  <li>服务端:  fabric-ca-server实现核心的PKI(Public Key Infrastructure: 公钥基础设施)服务功能， 支持多种数据库后台(包括SQlite3、MySQL、PostgreSQL等),  并支持集成LDAP用为用户注册管理功能</li>
  <li>客户端:  fabric-ca-client封装了服务端的RESTful API, 提供访问服务端的命令, 供用户与服务端进行交互</li>
</ul>

<h2 id="安装服务端与客户端">安装服务端与客户端</h2>

<p>安装Go1.9+</p>

<p>设置GOPATH环境变量</p>

<h3 id="安装libtool-与-libltdl-dev-依赖包">安装libtool 与 libltdl-dev 依赖包</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>$ sudo apt update
$ sudo apt install libtool libltdl-dev
</code></pre>
</div>

<h3 id="安装">安装</h3>

<p>安装服务端与客户端二进制命令到$GOPATH/bin目录下</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ go get -u github.com/hyperledger/fabric-ca/cmd/...
</code></pre>
</div>

<p>切换至源码目录下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cd $GOPATH/src/github.com/hyperledger/fabric-ca/
</code></pre>
</div>

<p>使用make命令编译：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ make fabric-ca-server
$ make fabric-ca-client
</code></pre>
</div>

<p>生成 <code class="highlighter-rouge">bin</code>  目录,  目录中包含  <code class="highlighter-rouge">fabric-ca-client </code>  与  <code class="highlighter-rouge">fabric-ca-server</code>  两个可执行文件</p>

<p>设置环境变量</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ export PATH=$GOPATH/src/github.com/hyperledger/fabric-ca/bin:$PATH
</code></pre>
</div>

<h3 id="初始化">初始化</h3>

<p>返回至用户目录</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ cd ~
$ mkdir fabric-ca
$ cd fabric-ca
</code></pre>
</div>

<p>fabric-ca启动:</p>

<ol>
  <li>使用init进行初始化
    <ol>
      <li>使用start启动</li>
    </ol>
  </li>
</ol>

<p>初始化</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fabric-ca-server init -b admin:pass
</code></pre>
</div>

<p>生成配置文件到至当前目录</p>

<ul>
  <li>fabric-ca-server-config.yaml:  默认配置文件</li>
  <li>ca-cert.pem:  PEM格式的CA证书文件, 自签名</li>
  <li>fabric-ca-server.db:   存放数据的sqlite数据库</li>
  <li>msp/keystore/:  路径下存放个人身份的私钥文件(_sk文件), 对应签名证书</li>
</ul>

<h3 id="快速启动">快速启动</h3>

<p>快速启动并初始化一个fabric-ca-server服务</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fabric-ca-server start -b admin:pass
</code></pre>
</div>

<p>-b:  提供注册用户的名称与密码, 如果没有使用LDAP, 这个选项为必需. 默认的配置文件的名称为fabric-ca-server-config.yaml</p>

<blockquote>
  <p>如果之前没有执行初始化命令, 则启动过程中会自动先进行初始化操作.  即从主配置目录搜索相关证书和配置文件, 如果不存在则会自动生成</p>
</blockquote>

<h3 id="restful-api">RESTful API</h3>

<p>在打开的新终端中输入以下命令获取指定CA服务的基本信息.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ curl -X POST -d '{"caname":"test_ca"}' http://localhost:7054/api/v1/cainfo
</code></pre>
</div>

<blockquote>
  <p>如要获取默认CA服务的基本信息, 可以不带任何参数, 如:</p>

  <div class="highlighter-rouge"><pre class="highlight"><code>$ curl -X POST http://localhost:7054/api/v1/cainfo
</code></pre>
  </div>

</blockquote>

<h2 id="服务端命令剖析">服务端命令剖析</h2>

<p>fabric-ca-server命令主要负责启动一个CA服务, 包括init和start两个子命令</p>

<h3 id="服务端配置文件解析">服务端配置文件解析</h3>

<p>fabric-ca-server-config.yaml配置文件包括通用配置, TLS配置, CA配置, 注册管理配置, 数据库配置, LDAP配置, 组织结构配置, 签名, 证书申请等几部分</p>

<div class="highlighter-rouge"><pre class="highlight"><code>version: 1.1.1-snapshot-e656889
port: 7054				# 指定服务的监听端口
debug: false			# 是否启用DEBUG模式, 输出更多的调试信息上
crlsizelimit: 512000

# 是否在服务端启用TLS,如果启用TLS后进行身份验证的证书和签名的私钥
tls:
  enabled: false		# 是否启用TLS, 默认不启用
  certfile:			# TLS证书文件
  keyfile:			# TLS密钥文件
  clientauth:	# 客户端验证配置
    type: noclientcert		# 默认不进行身份验证
    certfiles:		# 进行客户端身份验证时, 信任的证书文件列表

# 包括实例的名称、签名私钥文件、身份验证证书和证书链文件乖；这些私钥和证书文件会用来作为生成ECert、TCert的根证书
ca:		
  name:			# CA服务名称. 可以支持多个服务
  keyfile:		# 密钥文件(默认: ca-key.pem)
  certfile:		# 证书文件(默认: ca-cert.pem)
  chainfile:	# 证书链文件(默认: chain-cert.pem)

crl:
  expiry: 24h

# 当fabric-ca-server自身提供用户的注册管理时使用, 此情况下需要禁用LDAP功能, 否则fabric-ca-server将会把注册管理数据转发到LDAP进行查询
registry:
  # 允许同一个用户名和密码进行enrollment的最大次数, -1为无限制, 0为不支持登记
  maxenrollments: -1		
  identities:	# 注册的实体信息, 可以进行enroll. 只有当LDAP未启用时起作用
     - name: admin
       pass: adminpw
       type: client
       affiliation: ""
       attrs:
          hf.Registrar.Roles: "peer,orderer,client,user"
          hf.Registrar.DelegateRoles: "peer,orderer,client,user"
          hf.Revoker: true
          hf.IntermediateCA: true		# 该id是否是一个中间层的CA
          hf.GenCRL: true
          hf.Registrar.Attributes: "*"
          hf.AffiliationMgr: true

# 数据库支持SQLite3、MySQL、Postgres. 默认为SQLite3类型的本地数据库. 如果要配置集群, 则需要选用MySQL或Postgres后端数据库, 并在前端部署负载均衡器(如Nginx或HAProxy)
db:
  type: sqlite3
  datasource: fabric-ca-server.db		# SQLite3文件路径
  tls:
      enabled: false	# 是否启用TLS来连接到数据库
      certfiles:		# PEM格式的数据库服务器的TLS根证书, 可以指定多个, 用逗号隔开
      client:
        certfile:		# PEM格式的客户端证书文件
        keyfile:		# PEM格式的客户端证书私钥文件

# 配置使用远端的LDAP来进行注册管理, 认证enrollment的用户和密码, 并获取用户属性信息. 此时, 服务端将按照指定的usrfilter从LDAP获取对应的用户, 利用其唯一识别名(distinguidhed name)和给定的密码进行验证.
# 当LDAP功能启用时, registry中的配置将被忽略
ldap:
   enabled: false	# 是否启用LDAP, 默认不启用
   url: ldap://&lt;adminDN&gt;:&lt;adminPassword&gt;@&lt;host&gt;:&lt;port&gt;/&lt;base&gt; 	# LDAP的服务地址
   tls:
      certfiles:	# PEM格式的LDAP服务器的TLS根证书, 可以为多个, 用逗号隔开
      client:
         certfile:	# PEM格式的客户端证书文件
         keyfile:	# PEM格式的客户端证书私钥文件
   attribute:    
      names: ['uid','member']     
      converters:
         - name:
           value:      
      maps:
         groups:
            - name:
              value:

# 组织结构配置
affiliations:
   org1:
      - department1
      - department2
   org2:
      - department1

# 签发证书相关的配置包括签名方法、证书超时时间等. fabric-ca-server可以作为用户证书的签发CA(默认情况下), 也可以作为根CA来进一步支持其它中间CA
signing:
    default:	# 默认情况下,用于签署Ecert
      usage:	# 所签发证书的KeyUsage extension域
        - digital signature
      expiry: 8760h
    profiles:	# 不同的签发配置
      ca:	# 签署中间层CA证书时的配置模板
         usage:
           - cert sign	# 所签发证书的KeyUsage extension域
           - crl sign
         expiry: 43800h
         caconstraint:
           isca: true
           maxpathlen: 0	# 限制该中间层CA无法进一步签署中间层CA
      tls:
         usage:
            - signing
            - key encipherment
            - server auth
            - client auth
            - key agreement
         expiry: 8760h

# CA自身证书的申请请求配置. 当CA作为根证书服务时, 将基于请求生成一个自签名的证书; 当CA作为中间证书服务时, 将请求发送给上层的根证书进行签署
csr:
   cn: fabric-ca-server		# 建议与服务器名一致
   names:
      - C: US
        ST: "North Carolina"
        L:
        O: Hyperledger
        OU: Fabric
   hosts:
     - kevin-hf
     - localhost
   ca:		# 配置后会加入到证书的扩展字段
      expiry: 131400h		# 超时时间
      pathlength: 1			# 允许产生的中间证书的深度

# 配置所选择的加密库
bccsp:
    default: SW
    sw:
        hash: SHA2
        security: 256
        filekeystore:
            keystore: msp/keystore		# 存放密钥文件的路径

# 自动创建除了默认CA外的多个CA实例, 如ca1、ca2等
cacount:

# 可以指定多个CA配置文件路径, 每个配置文件会启动一个CA服务,注意不同配置文件之间需要避免出现冲突(如服务端口、TLS证书等)
cafiles:


# 当CA作为中间层CA服务时的相关配置. 包括父CA的地址和名称、登记信息、TLS配置等.
# 注意: 当intermediate.parentserver.url非空时, 意味着本CA是中间层CA服务,否则为根CA服务
intermediate:
  parentserver:		# 父CA相关信息
    url:
    caname:

  enrollment:		# 在父CA侧的登记信息
    hosts:			# 证书主机名列表
    profile:		# 签发所用的profile
    label:			# HSM操作中的标签信息

  tls:		# TLS相关配置
    certfiles:		# 信任的根CA证书
    client:			# 客户端验证启用时的相关文件
      certfile:
      keyfile:
</code></pre>
</div>

<h3 id="与服务器端进行交互">与服务器端进行交互</h3>

<p>可以采用包括RESTful API在内的多种方式与Fabric-CA服务端进行交互. 其中最方便的方式是通过客户端工具 fabric-ca-client</p>

<h4 id="登记用户">登记用户</h4>

<p>注册管理员需要以管理员身份使用CA Client连接到CA Server，并生成相应的文件</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ export PATH=$GOPATH/src/github.com/hyperledger/fabric-ca/bin:$PATH
$ fabric-ca-client enroll -u http://admin:pass@localhost:7054
</code></pre>
</div>

<blockquote>
  <p>如果生成的配置文件不是在当前目录下, 则运行登记命令后可能会产生如下错误</p>

  <div class="highlighter-rouge"><pre class="highlight"><code>Error: Response from server: Error Code: 20 - Authorization failure
解决方式: 返回至目录下重新启动服务
$ cd ~
$ fabric-ca-server start -b admin:pass
</code></pre>
  </div>
</blockquote>

<p>-u:   进行连接的fabric-ca-server服务地址, 默认为”http://localhost:7054”</p>

<p>该命令访问本地Fabric CA服务, 采用默认的admin用户进行登记. 默认情况下会在用户目录下的.fabric-ca-clien子目录下创建默认的配置文件 <code class="highlighter-rouge">fabric-ca-clien-config.yaml</code>  和  <code class="highlighter-rouge">msp</code>  子目录(包括签发的证书文件)</p>

<blockquote>
  <p>可以使用  <code class="highlighter-rouge">$ tree .fabric-ca-client/</code>  命令查看结构</p>
</blockquote>

<h4 id="注册用户">注册用户</h4>

<p>登记后的用户身份可以采用如下命令来注册一个新的用户:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fabric-ca-client register --id.name kevin --id.type user --id.affiliation org1.department1 --id.attrs '"hf.Registrar.Roles=peer,user"' --id.attrs 'hf.Revoker=true'
</code></pre>
</div>

<p>执行后输出:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>2018/05/02 14:39:28 [INFO] Configuration file location: /home/kevin/.fabric-ca-client/fabric-ca-client-config.yaml
Password: KDwrXkAFENWW
</code></pre>
</div>

<blockquote>
  <p><strong>命令执行成功后返回该新注册用户的密码</strong></p>

  <p><strong>如果想使用指定的密码, 在命令中添加选项  –id.secret password  即可</strong></p>
</blockquote>

<p>可以再次使用enroll命令，给kevin这个用户生成msp的私钥和证书</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fabric-ca-client enroll -u http://kevin:KDwrXkAFENWW@localhost:7054 -M kevinca
</code></pre>
</div>

<blockquote>
  <p>-M:  指定生成证书存放目录MSP的路径, 默认为”msp”</p>

  <p>命令执行成功后会在  <code class="highlighter-rouge">.fabric-ca-client</code>  目录下生成指定的userca目录,  在此目录下生成msp的私钥和证书</p>

  <p>可使用tree使用查看</p>

  <div class="highlighter-rouge"><pre class="highlight"><code>$ tree .fabric-ca-client/
</code></pre>
  </div>

  <p>输出内容如下:</p>

  <div class="highlighter-rouge"><pre class="highlight"><code>.fabric-ca-client/
├── fabric-ca-client-config.yaml
├── kevinca
│   ├── cacerts
│   │   └── localhost-7054.pem
│   ├── intermediatecerts
│   │   └── localhost-7054.pem
│   ├── keystore
│   │   ├── 8c7e4d893af9b9a5907299097edd69c9adee743f4421f81a2d73ed55a874545e_sk
│   │   └── ec63821399143fc422e01596eca622e8c658c0ded8e5c189804180256c40c19e_sk
│   └── signcerts
│       └── cert.pem
├── msp
    ├── cacerts
    │   └── localhost-7054.pem
    ├── intermediatecerts
    │   └── localhost-7054.pem
    ├── keystore
    │   └── eaa009831dc406950766cc1df104f6fb3ed4b456faa5f476dc41db817a873d2a_sk
    └── signcerts
        └── cert.pem
</code></pre>
  </div>
</blockquote>

<h4 id="登记节点">登记节点</h4>

<p>登记Peer或Orderer节点的操作与登记用户身份类似.  可以通过-M指定本地MSP的根路径来在其下存放证书文件</p>

<h5 id="注册节点">注册节点:</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fabric-ca-client register --id.name peer0 --id.type peer --id.affiliation org1.department1 --id.secret peer0pw
</code></pre>
</div>

<h5 id="登记节点-1">登记节点</h5>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fabric-ca-client enroll -u http://peer0:peer0pw@localhost:7054 -M peer0
</code></pre>
</div>

<h2 id="客户端命令剖析">客户端命令剖析</h2>

<p>fabric-ca-client命令可以与服务端进行交互, 包括五个子命令:</p>

<ul>
  <li>enroll:  登录获取ECert</li>
  <li>getcacert:  获取CA服务的证书链</li>
  <li>reenroll:  再次登录</li>
  <li>register:  注册用户实体</li>
  <li>revoke:  吊销签发的实体证书</li>
</ul>

<p>这些命令都是通过服务端的RESTful接口来进行操作的</p>

<h3 id="enroll命令">enroll命令</h3>

<p>向服务端申请签发ECert证书并将文件保存至本地</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fabric-ca-client enroll -u http://admin:pass@localhost:7054
</code></pre>
</div>

<h3 id="getcacert命令">getcacert命令</h3>

<p>向服务端申请根证书信息并保存至本地主配置目录的msp/cacerts路径下</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fabric-ca-client getcacert -u http://admin:pass@localhost:7054
</code></pre>
</div>

<p>证书命名格式为:  服务器主机名-CA实例名.pem</p>

<h3 id="reenroll命令">reenroll命令</h3>

<p>利用本地配置信息再次执行enroll过程, 生成新的签名证书材料</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fabric-ca-client reenroll
</code></pre>
</div>

<h3 id="register命令">register命令</h3>

<p>执行注册新用户实体的客户端必须已经通过登记认证, 并且拥有足够的权限(所注册用户的hf.Registrar.Roles和affiliation都不能超出调用者属性)来进行注册</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fabric-ca-client register --id.name jack --id.type user --id.affiliation org1.department1 --id.attrs '"hf.Registrar.Roles=peer,user"' --id.attrs 'hf.Revoker=true' --id.secret jackpw
</code></pre>
</div>

<h3 id="revoke命令">revoke命令</h3>

<p>吊销指定的证书或指定实体相关的所有证书. 执行revoke命令的客户端身份必须拥有足够的权限(hf.Revoker为true, 并且被吊销者机构不能超出吊销者机构的范围)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ fabric-ca-client revoke -e "jack" -r "affiliationchange"
</code></pre>
</div>

<p>-e:  指定吊销用户</p>

<p>-r:   指定吊销原因</p>

<p>输出内容如下</p>

<div class="highlighter-rouge"><pre class="highlight"><code>2018/05/02 17:55:44 [INFO] Configuration file location: .fabric-ca-client/fabric-ca-client-config.yaml
2018/05/02 17:55:44 [INFO] Sucessfully revoked certificates: []
</code></pre>
</div>

<h2 id="查看aki和序列号">查看AKI和序列号</h2>

<p>AKI: 公钥标识号, 代表了对该证书进行签发机构的身份</p>

<p>查看根证书的AKI与序列号信息:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ openssl x509 -in .fabric-ca-client/msp/signcerts/cert.pem -text -noout
</code></pre>
</div>

<p>输出内容如下:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:	# 序列号
            74:48:88:33:70:1a:01:a0:ad:32:29:6e:c5:ab:5a:fa:3b:91:25:a4
   ......
        X509v3 extensions:
           ......
            X509v3 Authority Key Identifier: 	# keyid后面的内容就是 AKI
                keyid:45:B1:50:B6:CD:8A:8D:C5:9B:9E:5F:75:15:47:D6:C0:AD:75:FE:71

    ......
</code></pre>
</div>

<h3 id="单独获取aki">单独获取AKI</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>$ openssl x509 -in .fabric-ca-client/msp/signcerts/cert.pem -text -noout | awk '/keyid/ {gsub (/ *keyid:|:/,"",$1);print tolower($0)}'
</code></pre>
</div>

<p>输出内容如下:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>45b150b6cd8a8dc59b9e5f751547d6c0ad75fe71
</code></pre>
</div>

<h3 id="单独获取序列号">单独获取序列号</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>$ openssl x509 -in .fabric-ca-client/msp/signcerts/cert.pem -serial -noout | cut -d "=" -f 2
</code></pre>
</div>

<p>输出内容如下:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>74488833701A01A0AD32296EC5AB5AFA3B9125A4
</code></pre>
</div>

  </section>
  <h2 style="color:red"><strong>版权声明：博客中的文章版权归博主所有，未经授权，禁止转载，转载请注明出处，合作请联系：chenjh07507(微信)</strong></h2>
</article>

<section>

            <div class="content-play">
              <p><a href="javascript:void(0)" onclick="dashangToggle()" class="dashang" title="打赏，支持一下">打赏一个呗</a></p>
              <div class="hide_box-play"></div>
              <div class="shang_box-play">
                <a class="shang_close-play" href="javascript:void(0)" onclick="dashangToggle()" title="关闭"><img src="/images/payimg/close.jpg" alt="取消" /></a>
                <div class="shang_tit-play">
                  <p>感谢您的支持，我会继续努力的!</p>
                </div>
                <div class="shang_payimg">
                    <img src="/images/payimg/alipayimg.jpg" alt="扫码支持" title="扫一扫" />
                </div>
              <div class="shang_payimg">    
                    <img src="/images/payimg/weipayimg.jpg" alt="扫码支持" title="扫一扫" />
                </div>
                <div class="pay_explain">扫码打赏，你说多少就多少</div>
                <div class="shang_payselect">
                  <div class="pay_item checked" data-id="alipay">
                    <span class="pay_logo"><img src="/images/payimg/alipay.jpg" alt="支付宝" /></span>
                  </div>
                  <div class="pay_item" data-id="weipay">
                    <span class="pay_logo"><img src="/images/payimg/wechat.jpg" alt="微信" /></span>
                  </div>
                </div>
                <div class="shang_info-play">
                  <p>打开<span id="shang_pay_txt">支付宝</span>扫一扫，即可进行扫码打赏哦</p>
                </div>
              </div>
            </div>
            <script type="text/javascript">
            function dashangToggle(){
              $(".hide_box-play").fadeToggle();
              $(".shang_box-play").fadeToggle();
            }
            </script>

            <div style="text-align:center;margin:50px 0; font:normal 14px/24px 'MicroSoft YaHei';"></div>

            <style type="text/css">
              .content-play{width:80%;margin-top: 20px;margin-bottom: 10px;height:40px;}
              .hide_box-play{z-index:999;filter:alpha(opacity=50);background:#666;opacity: 0.5;-moz-opacity: 0.5;left:0;top:0;height:99%;width:100%;position:fixed;display:none;}
              .shang_box-play{width:540px;height:540px;padding:10px;background-color:#fff;border-radius:10px;position:fixed;z-index:1000;left:50%;top:50%;margin-left:-280px;margin-top:-280px;border:1px dotted #dedede;display:none;}
              .shang_box-play img{border:none;border-width:0;}
              .dashang{display:block;width:100px;margin:5px auto;height:25px;line-height:25px;padding:10px;background-color:#E74851;color:#fff;text-align:center;text-decoration:none;border-radius:10px;font-weight:bold;font-size:16px;transition: all 0.3s;}
              .dashang:hover{opacity:0.8;padding:15px;font-size:18px;}
              .shang_close-play{float:right;display:inline-block;
                margin-right: 10px;margin-top: 20px;
              }
              .shang_logo{display:block;text-align:center;margin:20px auto;}
              .shang_tit-play{width: 100%;height: 75px;text-align: center;line-height: 66px;color: #a3a3a3;font-size: 16px;background: url('/images/payimg/cy-reward-title-bg.jpg');font-family: 'Microsoft YaHei';margin-top: 7px;margin-right:2px;}
              .shang_tit-play p{color:#a3a3a3;text-align:center;font-size:16px;}
              .shang_payimg{width:140px;padding:10px;padding-left: 80px; /*border:6px solid #EA5F00;**/margin:0 auto;border-radius:3px;height:140px;display:inline-block;}
              .shang_payimg img{display:inline-block;margin-right:10px;float:left;text-align:center;width:140px;height:140px; }
              .pay_explain{text-align:center;margin:10px auto;font-size:12px;color:#545454;}
              .shang_payselect{text-align:center;margin:0 auto;margin-top:40px;cursor:pointer;height:60px;width:500px;margin-left:110px;}
              .shang_payselect .pay_item{display:inline-block;margin-right:140px;float:left;}
              .shang_info-play{clear:both;}
              .shang_info-play p,.shang_info-play a{color:#C3C3C3;text-align:center;font-size:12px;text-decoration:none;line-height:2em;}
            </style>

       <ul class="pager">
        
        <li class="previous">
            <a href="/2018/07/12/%E9%93%BE%E7%A0%813-%E9%93%BE%E7%A0%81%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/" data-toggle="tooltip" data-placement="top" title="链码开发基础">上一篇：  <span>链码开发基础</span>
            </a>
        </li>
        
        
        <li class="next">
            <a href="/2018/07/13/%E9%93%BE%E7%A0%812-%E6%A6%82%E5%BF%B5%E4%BB%A5%E5%8F%8A%E4%BD%BF%E7%94%A8/" data-toggle="tooltip" data-placement="top" title="链码的概念与使用">下一篇：  <span>链码的概念与使用</span>
            </a>
        </li>
        
    </ul>
</section>

<section class="post-comments">
  <!--PC和WAP自适应版-->
<div id="SOHUCS" sid=Fabric CA 应用与配置 ></div>
<script type="text/javascript">
(function(){
var appid = 'cytfSz8yx';
var conf = 'prod_ad710bf09d342725ed536beddc68aa27';
var width = window.innerWidth || document.documentElement.clientWidth;
if (width < 960) {
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="http://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("http://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>
</section>

 <section class="footer">
  <footer>
    <div class="footer_div">
      <nav class="cover-navigation navigation--social">
        <ul class="navigation">

          
          <!-- Weibo -->
          <li class="navigation__item_social">
            <a href="http://weibo.com/http://weibo.com/bitchenjh" title="@http://weibo.com/bitchenjh 的微博" target="_blank">
              <i class='social fa fa-weibo fa-2x'></i>
              <span class="label">Weibo</span>
            </a>
          </li>
           
          <!-- Github -->
          <li class="navigation__item_social">
            <a href="https://github.com/bitchenjh" title="@bitchenjh 的 Github" target="_blank">
              <i class='social fa fa-github fa-2x'></i>
              <span class="label">Github</span>
            </a>
          </li>
            

          <!-- RSS -->
          <li class="navigation__item_social">
            <a href="/feed.xml" rel="author" title="RSS" target="_blank">
              <i class='social fa fa-rss fa-2x'></i>
              <span class="label">RSS</span>
            </a>
          </li>

          
          <!-- Email -->
          <li class="navigation__item_social">
            <a href="mailto:cjhcjlu@163.com" title="Contact me">
              <i class='social fa fa-envelope fa-2x'></i>
              <span class="label">Email</span>
            </a>
          </li>
          

        </ul>
      </nav>

    </div>

    <table width="100%" border="0" cellspacing="0" cellpadding="0">
      <thead>
        <tr id="bar_head">
          <th colspan="11">友情链接</th>
        </tr>
      </thead>

      <tr align="center" valign="middle">
          <td><a href="http://www.kongyixueyuan.com">区块链技术视频网站</a></td>

          <td><a href="https://www.ethereum.org">以太坊官网</a></td>

          <td><a href="https://solidity.readthedocs.io/en/develop/">Solidity</a></td>

          <td><a href="http://truffleframework.com/">Truffle FrameWork</a></td>

          <td><a href="http://embark.readthedocs.io">Embark FrameWork</a></td>

      </tr>
      <tr align="center" valign="middle">

          <td><a href="https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=3302cc3b-074e-44da-90b1-5055f1dc0d9c&amp;lang=zh">IBM开源技术微讲堂</a></td>

          <td><a href="https://www.bitcoin.com/">Bitcoin.com</a></td>

          <td><a href="https://github.com/bitshares/bitshares1-core">bitshares1-core</a></td>

          <td><a href="https://ipfs.io">ipfs官网</a></td>

          <td><a href="http://ipfser.org">ipfs中文网</a></td>

      </tr>
    </table>

    <div class="footer_div">
      <p class="copyright text-muted">
        Copyright &copy; 2018 陈建辉区块链博客 QQ：905739007
      </p>
      <div align="right">
        <link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
        <!-- 访问统计 -->
        <span id="busuanzi_container_site_pv">
            本站总访问量
            <span id="busuanzi_value_site_pv"></span>次
        </span>

      </div>
      <div>
  </footer>
</section>

    </div>
  </div>

  <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


</body>

</html>